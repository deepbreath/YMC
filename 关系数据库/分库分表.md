#对分库分表的比喻?
1. 在后厨仓库内, 一个品类货架有限,只能放五个食品,    
随着门店用餐客户增加,存放五个食品,用于作为日常备货显然是不够的了.    
需要为这一品类商品单独开一个货架,专门存放  (垂直切分)  
在原有仓库货架后面在架起一列货架存放 (水平切分)  

区别在于:  
1.将一堆商品内的,那个一个商品单独拎出来,存放在单独货架上    
2.在一堆商品内,在原有基础上扩展货架,还是原来的地方,就在随手旁边就能获取到.  


为什么需要分库分表?  
随着数据量的增咋, 单表达到一定数量级后查询速度下降,   
虽然数据库会给表增加隐形索引,但是索引也是占用实际存储空间的.    
所以需要对数据库进行分库分表操作.    
分表有目前两种主流区分方式:    
1.垂直拆分  
    将很多字段的表拆分成多个表,或者多个数据库上.  
    一般策略:将较少的,访问频率高的字段放到一张表中,将访问频率低,数据量多的字段放到另外一张表内.
触发条件:  
    1.MYSQL 单表超过 5000万条数据, Oracle 超过 1 亿条数据  
    2.单表并发在 2000时,(单表请求 健康值 1000 左右并发)  

2.水平拆分:  
    将同一张表中的记录拆分到多个结构相同的表中.当单表数据量查过上限时,会影响查询速度.  
    将一张表分布到数据库集群的不同节点时候,从而缓解单点压力.  
触发条件:  
    1.单表 200 万数据的时候,需要考虑分表,SQL 越复杂单表行数越少为好  

数据由来:  
MYSQL 单表数据量上限:  
PGSQL 单表数据量上限:  
为了支撑高并发,数据量大的两个问题  

分库分表的策略:  
1.Hash取模  
  优点:平均分配每个库的数据量和请求压力(负载均衡)    
  缺点:扩容麻烦,需要数据迁移  
2.按照 ID 或者 时间划分范围  
  优点:扩容简单  
  缺点:容易产生热点问题  
3.使用单独的一个数据库来存储映射关系  
  优点:扩容简单,解决分布式 ID 问题    
  缺点:存储映射关系数据库可能产生性能瓶颈,一旦宕机,分库分表的数据库将无法工作  

分库分表的优点:  

| |分库分表前|分库分表后|
|----|----|----|
| 并发支撑情况|单机部署，扛不住高并发|从单机到多机，能承受的并发增加了多倍|
| 磁盘使用情况|单机磁盘容量几乎撑满| 拆分为多个库，数据库服务器磁盘使用率大大降低|
| SQL 执行性能|单表数据量太大，SQL 越跑越慢|单表数据量减少，SQL 执行效率明显提升|

分库分表的缺点:  
分库的话:涉及到分布式事务  
数据迁移,扩容  


分库分表技术选型:    
1.Cobar  
2.TDDL  
3.Atlas  
4.sharding-jdbc  
5.Mycat  

